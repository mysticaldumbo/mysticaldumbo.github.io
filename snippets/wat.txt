;; Define a function that calculates the factorial of a number
(func $factorial (param $n i32) (result i32)
  ;; Local variables
  (local $result i32)

  ;; Initialize the result variable to 1
  (set_local $result i32.const 1)

  ;; Loop from 2 to n and multiply the result
  (block
    (loop $loop
      ;; Compare n with 1
      (if (i32.eq (get_local $n) (i32.const 1))
        ;; If n is 1, exit the loop
        (then
          (br $exit)
        )
      )
      
      ;; Multiply the result by n
      (set_local $result
        (i32.mul
          (get_local $result)  ;; Current result
          (get_local $n)       ;; Current n
        )
      )
      
      ;; Decrement n
      (set_local $n
        (i32.sub
          (get_local $n)  ;; Current n
          (i32.const 1)   ;; 1
        )
      )

      ;; Continue looping
      (br $loop)
    )
  )

  ;; Label to exit the loop
  (block $exit
    ;; Return the result
    (get_local $result)
  )
)

;; Export the factorial function
(export "factorial" (func $factorial))